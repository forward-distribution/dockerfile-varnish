{
	"Name": "Advanced Policy",
	"Rules": [
    {
			"Name": "If page already seen then grant access",
			"RuleCondition": {
				"HasSeen": {
          "ParameterName": "REQUEST_URI",
          "CookieName": "AccessToken"
        }
			},
			"Consequences": [
				{
					"GrantAccess": {}
				},
				{
					"ReturnResponse": {
						"ObjectName": "HasSeen",
						"ObjectData": {
							"Description": "HasSeen",
							"Value": "true"
						}
					}
				}
			],
			"StopEvaluationOnMatch": true
		},
		{
			"Name": "MeteredPaywall",
			"StopEvaluationOnMatch": true,
			"RuleCondition": {
				"And": {
					"FirstArgument": {
						"CheckValue": {
							"ValueToExpect": "paid",
							"ParameterName": "PaywallType"
						}
					},
					"SecondArgument": {
						"DoesMeterExceed": {
							"Count": 5,
							"MeterName": "PaywallMeter",
							"MeterExpiryPeriod": "30d",
							"CookieName": "AccessToken"
						}
					}
				}
			},
			"Consequences": [
				{
					"Redirect": {
						"Location": "pid=true",
						"StatusCode": 302
					}
				},
				{
					"ReturnResponse": {
						"ObjectName": "DoesMeterExceed",
						"ObjectData": {
							"Description": "DoesMeterExceed",
							"Value": "true"
						}
					}
				}
			]
		},
		{
			"Name": "Track the request",
			"StopEvaluationOnMatch": false,
			"RuleCondition": {
				"CheckValue": {
					"ValueToExpect": "paid",
					"ParameterName": "PaywallType"
				}
			},
			"Consequences": [
				{
					"IncrementMeter": {
						"MeterName": "PaywallMeter",
						"CookieName": "AccessToken"
					}
				},
        {
					"IncrementMeter": {
						"MeterName": "Pageviews",
						"CookieName": "AccessToken"
					}
				},
				{
					"MarkAsSeen": {
						"ParameterName": "REQUEST_URI",
						"CookieName": "AccessToken"
					}
				},
				{
					"ReturnResponse": {
						"ObjectName": "MarkAsSeen",
						"ObjectData": {
							"Description": "MarkAsSeen",
							"Value": "true"
						}
					}
				}
			]
		},
    {
			"Name": "TrackPages",
			"StopEvaluationOnMatch": false,
			"RuleCondition": {
				"CheckValue": {
					"ValueToExpect": "page",
					"ParameterName": "PaywallType"
				}
			},
			"Consequences": [
				{
					"IncrementMeter": {
						"MeterName": "Pageviews",
						"CookieName": "AccessToken"
					}
				},
				{
					"MarkAsSeen": {
						"ParameterName": "REQUEST_URI",
						"CookieName": "AccessToken"
					}
				},
				{
					"ReturnResponse": {
						"ObjectName": "Page",
						"ObjectData": {
							"Description": "Page",
							"Value": "true"
						}
					}
				}
			]
		},
		{
			"Name": "FlyInLayer",
			"StopEvaluationOnMatch": true,
			"RuleCondition": {
				"And": {
					"FirstArgument": {
            "Or": {
              "FirstArgument": {
                "CheckValue": {
                  "ValueToExpect": "paid",
                  "ParameterName": "PaywallType"
                }
              },
              "SecondArgument": {
                "CheckValue": {
                  "ValueToExpect": "page",
                  "ParameterName": "PaywallType"
                }
              }
            }
					},
					"SecondArgument": {
            "And": {
              "FirstArgument": {
                "Not": {
                  "Condition": {
                    "DoesMeterExceed": {
                      "MeterName": "Pageviews",
                      "MeterExpiryPeriod": "30d",
                      "Count": 3,
                      "CookieName": "AccessToken"
                    }
                  }
                }
              },
              "ThirdArgument": {
                "Not": {
                  "Condition": {
                    "DoesMeterExceed": {
                      "MeterName": "FlyInLayerView",
                      "MeterExpiryPeriod": "30d",
                      "Count": 4,
                      "CookieName": "AccessToken"
                    }
                  }
                }
              },
              "SecondArgument": {
                "Not": {
                  "Condition": {
                    "DoesMeterExceed": {
                      "MeterName": "FlyInLayerView",
                      "MeterExpiryPeriod": "1d",
                      "Count": 0,
                      "CookieName": "AccessToken"
                    }
                  }
                }
              }
            }
					}
				}
			},
			"Consequences": [
        {
					"IncrementMeter": {
						"MeterName": "FlyInLayerView",
						"CookieName": "AccessToken"
					}
				},
				{
					"Redirect": {
						"Location": "pwlayout=layer_footer_flyin",
						"StatusCode": 302
					}
				},
				{
					"ReturnResponse": {
						"ObjectName": "DoesMeterExceed",
						"ObjectData": {
							"Description": "DoesMeterExceed",
							"Value": "true"
						}
					}
				}
			]
		}
	]
}